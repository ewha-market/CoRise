{% extends "index.html" %} 
{% block head %} 
{{ super() }}
    <link rel="stylesheet"  href="{{ url_for('static', filename='item_style.css') }}">
{% endblock head %} 

{% block section %}

<main class="pd-wrap" aria-label="상품 상세">
  <!-- 좌측: 이미지 갤러리 -->
  <section class="pd-gallery">
    
    {% set img_list = data.img_path if data.img_path is sequence and data.img_path is not string else [data.img_path] %}
    
    <div class="thumbs">
        {% for img in img_list %}
            <button class="thumb" aria-label="이미지 {{ loop.index }}" 
                    onclick="changeHero('{{ url_for('static', filename='images/' + img) }}')">
                <img src="{{ url_for('static', filename='images/' + img) }}" style="width:100%; height:100%; object-fit:cover;">
            </button>
        {% endfor %}
    </div>

    <div class="hero">
      <img id="heroImage" src="{{ url_for('static', filename='images/' + img_list[0]) }}" alt="{{ name }}" width="350" height="350">
    </div>
  </section>

  <!-- 우측: 상품 기본 정보 -->
  <section class="pd-meta">
    <div class="meta-line">
      <span class="label">카테고리:</span>
      <span class="value">{{ data.category }}</span>
    </div>

    <div class="meta-divider"></div>

    <h1 class="pd-title">{{ name }}</h1>
    <div class="pd-price">{{ data.price }}원</div>

    <div class="meta-bottom">
      <div class="seller-block">
        <div class="seller-line">
          <span class="seller-label">판매자:</span>
          <span class="seller-value">{{ nickname }}</span>
        </div>
        <div class="seller-line">
          <span class="seller-label">주소:</span>
          <span class="seller-value">{{ data.addr }}</span>
        </div>
      </div>

      <div class="actions">
        <i class="fa fa-heart" id="heart" ></i>
        <!-- 원래 찜 코드
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
                <path
                    d="M41.68 9.22C40.6585 8.19801 39.4456 7.3873 38.1107 6.83417C36.7758 6.28105 35.345 5.99635 33.9 5.99635C32.455 5.99635 31.0242 6.28105 29.6893 6.83417C28.3544 7.3873 27.1415 8.19801 26.12 9.22L24 11.34L21.88 9.22C19.8166 7.15662 17.0181 5.99742 14.1 5.99742C11.1819 5.99742 8.38338 7.15662 6.31999 9.22C4.25661 11.2834 3.09741 14.0819 3.09741 17C3.09741 19.9181 4.25661 22.7166 6.31999 24.78L24 42.46L41.68 24.78C42.702 23.7585 43.5127 22.5456 44.0658 21.2107C44.6189 19.8758 44.9036 18.445 44.9036 17C44.9036 15.555 44.6189 14.1242 44.0658 12.7893C43.5127 11.4544 42.702 10.2415 41.68 9.22Z"
                    stroke="#1E1E1E"
                    stroke-width="4"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                /> 
            </svg>-->
        </button>
        <button type="button" class="btn primary" onclick="purchaseItem()">구매하기</button>
        <button class="btn" onclick='window.location.href="{{ url_for("view_review_by_item", name=name) }}"'>리뷰 보기</button>
        <!-- 12주차 과제 리뷰 등록 버튼 제거 후 다시 상품 리뷰 보기 -->
      </div>
    </div>
  </section>

  <!-- 하단: 상품 정보 -->
  <section class="pd-info">
    <h2>상품 정보</h2>
    <div class="info-card">
      <p class="pd-description">{{ data.description }}</p>
    </div>
  </section>
</main>

<script>
  function changeHero(imageSrc) {
    const heroImg = document.getElementById("heroImage");
    heroImg.src = imageSrc;
  }

  function purchaseItem() {
    var msg = "구매하시겠습니까?\n\n" + 
                "상품명: {{ name }}\n" + 
                "가격: {{ data.price }}원";
    
    if (confirm(msg)) {
      location.href = "{{ url_for('order_item', item_id=item_id) }}";
    }
  }



// showHeart, like, unlike URL 경로를 item_id 기반으로 변경
  function showHeart() {
    $.ajax({
      type: 'GET',
      url: '/show_heart/{{ item_id }}/',
      data: {},
      success: function (response) {
        let my_heart = response['my_heart'];
        if (my_heart && my_heart['interested'] == 'Y')
        {
          $("#heart").css("color","red");
          $("#heart").attr("onclick","unlike()");
        }
        else
        {
          $("#heart").css("color","grey");
          $("#heart").attr("onclick","like()");
        }
      }
    });
  }

  function like() {
    $.ajax({
      type: 'POST',
      url: '/like/{{ item_id }}/',
      data: {
      interested : "Y"
      },
      success: function (response) {
        alert(response['msg']);
        window.location.reload()
      }
    });
  }

  function unlike() {
    $.ajax({
      type: 'POST',
      url: '/unlike/{{ item_id }}/',
      data: {
      interested : "N"
      },
      success: function (response) {
        alert(response['msg']);
        window.location.reload()
      }
    });
  }
  $(document).ready(function () {
    showHeart();
  });
</script>
{% endblock section %}