{% extends "index.html" %} {% block head %} {{ super() }}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='review_style.css') }}"
/>
{% endblock head %} {% block section %}

<div class="rvbyitem-top-bar">
  <div class="rvbyitem-info-box">
    <span class="rvbyitem-label">상품 : <strong>{{ product_name }}</strong></span>
    <span class="rvbyitem-divider">|</span>
    <span class="rvbyitem-label">평균 별점 :</span>
    <span class="rvbyitem-score">{{ avg_rating|default('0.0') }}</span>
  </div>
  
  <form class="rvbyitem-sorts" method="get" action="{{ url_for('view_review_by_item', name=product_name) }}">
    <label class="select-pill">
      {% set current_sort = request.args.get('sort', '최신순') %}
      <select class="rvall-sort-cat" name="sort" onchange="this.form.submit()">
        <option value="최신순"     {{ 'selected' if current_sort == '최신순' else '' }}>최신순</option>
        <option value="오래된 순"   {{ 'selected' if current_sort == '오래된 순' else '' }}>오래된 순</option>
        <option value="별점높은순" {{ 'selected' if current_sort == '별점높은순' else '' }}>별점높은순</option>
        <option value="별점낮은순" {{ 'selected' if current_sort == '별점낮은순' else '' }}>별점낮은순</option>
      </select>
      <svg class="chev" width="22" height="16" viewBox="0 0 28 19" fill="none" aria-hidden="true">
        <path d="M13.2826 18.1387C13.4826 18.4042 13.8813 18.404 14.0814 18.1387L26.7621 1.30078C27.0102 0.97129 26.7751 0.5 26.3627 0.5H1.00134C0.589257 0.500359 0.354175 0.971424 0.601929 1.30078L13.2826 18.1387Z" fill="#FBFAF4" stroke="black"/>
      </svg>
    </label>
  </form>
</div>

<div class="rvall-list">
  {% if reviews %}
    {% for rid, rv in reviews.items() %}
      <div class="rvall-card" onclick="location.href='{{ url_for('view_review_detail', key=rid) }}';" style="cursor:pointer;">
        <div class="rvall-card-content-wrapper">

          <div class="rvall-main-content">
            <div class="rvall-review-header">
              <div class="rvall-user-info">
                <div class="rvall-avatar"></div>
                <div class="rvall-user-name">{{ rv.nickname }}</div>
              </div>
            </div>
            <div class="rvall-review-title-section">
              <h3 class="rvall-review-title">{{ rv.title }}</h3>
              <div class="rvall-rating">
                {% set rating = (rv.rate or rv.rating or 0) | int %}
                {% for i in range(rating) %}
                  <span class="star star--filled">★</span>
                {% endfor %}
                {% for i in range(5 - rating) %}
                  <span class="star star--empty">☆</span>
                {% endfor %}
              </div>
            </div>

            <div class="rvall-review-text-block">
              <p class="rvall-review-text">
                {{ rv.review | replace('\n', '<br>') | safe }}
              </p>
            </div>
          </div>

          <div class="rvall-media-placeholder">
            {% if rv.img_path %}
              <img src="{{ url_for('static', filename='images/' + rv.img_path) }}"
                   alt="리뷰 이미지"
                   class="rvall-media-img">
            {% endif %}
          </div>
        </div>
        <hr class="rvall-divider" />
      </div>
    {% endfor %}
  {% else %}
    <p class="norv-text">등록된 리뷰가 없습니다.</p>
  {% endif %}

  <!-- 페이지네이션 -->
  <nav class="pagination">
    {% if page > 0 %}
      <a class="page-btn"
         href="{{ url_for('view_review_by_item', name=product_name, page=page-1, sort=current_sort) }}">&lsaquo;</a>
    {% else %}
      <span class="page-btn" style="opacity:0.4; pointer-events:none;">&lsaquo;</span>
    {% endif %}

    {% for i in range(page_count) %}
      <a class="page-number {% if i == page %}active{% endif %}"
         href="{{ url_for('view_review_by_item', name=product_name, page=i, sort=current_sort) }}">
        {{ i + 1 }}
      </a>
    {% endfor %}

    {% if page < page_count - 1 %}
      <a class="page-btn"
         href="{{ url_for('view_review_by_item', name=product_name, page=page+1, sort=current_sort) }}">&rsaquo;</a>
    {% else %}
      <span class="page-btn" style="opacity:0.4; pointer-events:none;">&rsaquo;</span>
    {% endif %}
  </nav>
</div>
{% endblock section %}
